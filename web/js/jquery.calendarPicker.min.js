jQuery.fn.calendarPicker=function(a){a.date||(a.date=new Date),"undefined"==typeof a.years&&(a.years=1),"undefined"==typeof a.months&&(a.months=3),"undefined"==typeof a.days&&(a.days=4),"undefined"==typeof a.hours&&(a.hours=4),"undefined"==typeof a.minutes&&(a.minutes=2),"undefined"==typeof a.showDayArrows&&(a.showDayArrows=!0),"undefined"==typeof a.useWheel&&(a.useWheel=!0),"undefined"==typeof a.callbackDelay&&(a.callbackDelay=500),"undefined"==typeof a.monthNames&&(a.monthNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]),"undefined"==typeof a.dayNames&&(a.dayNames=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]);var b={currentDate:a.date};b.options=a;var c=this.eq(0);c.addClass("calBox"),c.empty();var d=$("<div>").addClass("calYear"),e=$("<div>").addClass("calMonth"),f=$("<div>").addClass("calDay"),g=$("<div>").addClass("calHour"),h=$("<div>").addClass("calMinute");return c.append(d).append(e).append(f).append(g).append(h),b.changeDate=function(i){b.currentDate=i;var j=function(e){var f=e.getFullYear(),g=new Date;d.empty();for(var h=2*a.years+1,i=parseInt((c.width()-4-4*h)/h)+"px",j=f-a.years;j<=f+a.years;j++){var k=new Date(e);k.setFullYear(j);var l=$("<span>").addClass("calElement").attr("millis",k.getTime()).html(j).css("width",i);k.getYear()==g.getYear()&&l.addClass("today"),k.getYear()==b.currentDate.getYear()&&l.addClass("selected"),d.append(l)}},k=function(d){var f=d.getMonth(),g=new Date;e.empty();for(var h=d.getDay(),i=2*a.months+1,j=parseInt((c.width()-4-4*i)/i)+"px",k=-a.months;k<=a.months;k++){var l=new Date(d),h=l.getDate();l.setMonth(f+k),l.getDate()!=h&&(l.setMonth(l.getMonth()-1),l.setDate(28));var m=$("<span>").addClass("calElement").attr("millis",l.getTime()).html(a.monthNames[l.getMonth()]).css("width",j);l.getYear()==g.getYear()&&l.getMonth()==g.getMonth()&&m.addClass("today"),l.getYear()==b.currentDate.getYear()&&l.getMonth()==b.currentDate.getMonth()&&m.addClass("selected"),e.append(m)}},l=function(d){var e=d.getDate(),g=new Date;f.empty();for(var h=2*a.days+1,i=parseInt((c.width()-4-(a.showDayArrows?12:0)-4*h)/(h-(a.showDayArrows?2:0)))+"px",j=-a.days;j<=a.days;j++){var k=new Date(d);k.setDate(e+j);var l=$("<span>").addClass("calElement").attr("millis",k.getTime());l.html("<span class=dayNumber>"+k.getDate()+"</span><br>"+a.dayNames[k.getDay()]).css("width",i),k.getYear()==g.getYear()&&k.getMonth()==g.getMonth()&&k.getDate()==g.getDate()&&l.addClass("today"),k.getYear()==b.currentDate.getYear()&&k.getMonth()==b.currentDate.getMonth()&&k.getDate()==b.currentDate.getDate()&&l.addClass("selected"),f.append(l)}},m=function(d){var e=d.getHours(),f=new Date;g.empty();for(var h=2*a.hours+1,i=parseInt((c.width()-4-(a.showDayArrows?12:0)-4*h)/(h-(a.showDayArrows?2:0)))+"px",j=-a.hours;j<=a.hours;j++){var k=new Date(d);k.setHours(e+j);var l=$("<span>").addClass("calElement").attr("millis",k.getTime());l.html("<span class=hourNumber>"+k.getHours()+" h</span>").css("width",i),k.getHours()==f.getHours()&&l.addClass("today"),k.getHours()==b.currentDate.getHours()&&l.addClass("selected"),g.append(l)}},n=function(d){var e=15*parseInt(d.getMinutes()/15),f=new Date;h.empty();for(var g=2*a.minutes+1,i=parseInt((c.width()-4-(a.showDayArrows?12:0)-4*g)/(g-(a.showDayArrows?2:0)))+"px",j=-a.minutes;j<=a.minutes;j++){var k=new Date(d);k.setMinutes(e+15*j);var l=$("<span>").addClass("calElement").attr("millis",k.getTime());l.html("<span class=minuteNumber>"+k.getMinutes()+" min</span>").css("width",i),k.getMinutes()==15*parseInt(f.getMinutes()/15)&&l.addClass("today"),k.getMinutes()==15*parseInt(b.currentDate.getMinutes()/15)&&l.addClass("selected"),h.append(l)}},o=function(){"function"==typeof a.callback&&(b.timer&&clearTimeout(b.timer),b.timer=setTimeout(function(){a.callback(b)},a.callbackDelay))};j(i),k(i),l(i),m(i),n(i),o()},c.click(function(a){var c=$(a.target).closest(".calElement");c.hasClass("calElement")&&b.changeDate(new Date(parseInt(c.attr("millis"))))}),$.event.special.mousewheel&&a.useWheel&&(d.mousewheel(function(a,c){var d=new Date(b.currentDate.getTime());return d.setFullYear(d.getFullYear()+c),b.changeDate(d),!1}),e.mousewheel(function(a,c){var d=new Date(b.currentDate.getTime());return d.setMonth(d.getMonth()+c),b.changeDate(d),!1}),f.mousewheel(function(a,c){var d=new Date(b.currentDate.getTime());return d.setDate(d.getDate()+c),b.changeDate(d),!1}),g.mousewheel(function(a,c){var d=new Date(b.currentDate.getTime());return d.setHours(d.getHours()+c),b.changeHours(d),!1}),h.mousewheel(function(a,c){var d=new Date(b.currentDate.getTime());return d.setMinutes(d.getMinutes()+c),b.changeMinutes(d),!1})),b.changeDate(a.date),b};